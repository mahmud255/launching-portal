name: Auto update (every 3 days)

on:
  schedule:
    - cron: '0 3 */3 * *'   # ~09:00 Asia/Dhaka
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Configure git author (GitHub noreply keeps email private)
        run: |
          git config user.name  'mahmud255'
          git config user.email 'mahmud255@users.noreply.github.com'
          git config --list --show-origin

      - name: Rotate accent color (pure Node, no extra installs)
        run: |
          node - <<'NODE'
          const fs = require('fs');
          const path = 'config.json';
          const DEFAULT = {
            accent: '#2DD4BF',
            palette: ['#2DD4BF','#60A5FA','#A78BFA','#F472B6','#F87171','#F59E0B']
          };
          let cfg = DEFAULT;
          if (fs.existsSync(path)) {
            try {
              const cur = JSON.parse(fs.readFileSync(path, 'utf8'));
              cfg = { ...DEFAULT, ...cur };
              if (!Array.isArray(cfg.palette) || !cfg.palette.length) cfg.palette = DEFAULT.palette;
            } catch { cfg = DEFAULT; }
          }
          const arr = cfg.palette;
          const idx = Math.max(0, arr.findIndex(c => (c || '').toLowerCase() === (cfg.accent || '').toLowerCase()));
          const next = arr[(idx + 1) % arr.length];
          cfg.accent = next;
          fs.writeFileSync(path, JSON.stringify(cfg, null, 2) + '\n');
          console.log('accent ->', next);
          NODE

      - name: Commit & push changes (if any)
        run: |
          git add config.json
          if git diff --cached --quiet; then
            echo "No changes to commit."
            exit 0
          fi
          git commit -m "chore: scheduled update"
          git push
